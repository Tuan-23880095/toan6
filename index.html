<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi Thử Toán 6 - Mã Đề 05 (Nâng Cao)</title>
    <style>
        :root { --primary: #2563eb; --success: #22c55e; --danger: #ef4444; --bg: #f1f5f9; --text: #1e293b; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        /* Header */
        .header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; border-bottom: 2px solid #e2e8f0; padding-bottom: 20px; margin-bottom: 30px; gap: 15px; }
        .header h1 { margin: 0; font-size: 1.8rem; color: var(--primary); }
        .timer { font-size: 1.5rem; font-weight: 800; color: white; background: var(--primary); padding: 10px 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3); }
        
        /* Student Info Input */
        .student-info { width: 100%; margin-top: 15px; }
        .name-input { width: 100%; padding: 12px; border: 2px solid #cbd5e1; border-radius: 8px; font-size: 1rem; transition: 0.3s; }
        .name-input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2); }

        /* Section Styles */
        .section-header { background: #eff6ff; border-left: 5px solid var(--primary); padding: 15px 20px; margin: 40px 0 20px 0; border-radius: 0 8px 8px 0; }
        .section-header h2 { margin: 0; font-size: 1.2rem; color: #1e40af; }
        .section-desc { margin: 5px 0 0 0; font-size: 0.9rem; color: #64748b; }

        /* Question Card */
        .question-card { background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 20px; transition: transform 0.2s; }
        .question-card:hover { border-color: #cbd5e1; }
        .q-number { font-weight: 800; color: var(--primary); margin-right: 8px; }
        .q-content { font-weight: 600; font-size: 1.05rem; margin-bottom: 15px; display: block; }
        
        /* MCQ Options */
        .mcq-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px; }
        .mcq-option { display: flex; align-items: center; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .mcq-option:hover { background: #f8fafc; border-color: #94a3b8; }
        .mcq-option input { margin-right: 12px; transform: scale(1.2); }
        .mcq-option.selected { border-color: var(--primary); background: #eff6ff; }

        /* True/False Table */
        .tf-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .tf-table th, .tf-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        .tf-table th { background: #f8fafc; color: #64748b; font-size: 0.9rem; }
        .tf-btn-group { display: flex; gap: 5px; }
        .tf-btn { padding: 6px 12px; border: 1px solid #cbd5e1; border-radius: 6px; background: white; cursor: pointer; font-weight: 600; font-size: 0.85rem; }
        .tf-btn.active-true { background: var(--primary); color: white; border-color: var(--primary); }
        .tf-btn.active-false { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* Drag & Drop (Click to Fill) */
        .dd-area { background: #f8fafc; padding: 20px; border-radius: 8px; border: 2px dashed #cbd5e1; }
        .dd-sentence { font-size: 1.1rem; line-height: 1.8; margin-bottom: 20px; }
        .dd-slot { display: inline-block; min-width: 100px; height: 30px; border-bottom: 2px solid var(--primary); color: var(--primary); font-weight: bold; text-align: center; cursor: pointer; padding: 0 10px; background: white; vertical-align: bottom; }
        .dd-slot.filled { background: #eff6ff; border: 2px solid var(--primary); border-radius: 6px; border-bottom: 2px solid var(--primary); }
        .dd-options { display: flex; flex-wrap: wrap; gap: 10px; }
        .dd-chip { padding: 8px 16px; background: white; border: 1px solid #cbd5e1; border-radius: 20px; cursor: pointer; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.05); user-select: none; }
        .dd-chip:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .dd-chip.used { opacity: 0.5; background: #e2e8f0; cursor: default; transform: none; box-shadow: none; }
        .dd-chip.selected { border-color: var(--primary); background: #eff6ff; color: var(--primary); }

        /* Short Answer */
        .sa-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; font-family: inherit; transition: border-color 0.2s; }
        .sa-input:focus { border-color: var(--primary); outline: none; }

        /* Result Styles */
        .result-feedback { margin-top: 15px; padding: 12px; border-radius: 8px; font-size: 0.95rem; display: none; }
        .result-feedback.correct { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .result-feedback.wrong { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        .explanation { font-size: 0.85rem; margin-top: 5px; font-style: italic; opacity: 0.9; }

        /* Charts */
        .chart-visual { height: 160px; display: flex; align-items: flex-end; gap: 20px; padding: 20px; background: #fffbeb; border-radius: 8px; border: 1px dashed #f59e0b; margin-bottom: 15px; }
        .bar-col { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 100%; gap: 5px; }
        .bar-pair { display: flex; align-items: flex-end; gap: 4px; height: 100%; }
        .bar { width: 24px; background: var(--primary); border-radius: 4px 4px 0 0; position: relative; transition: height 1s; }
        .bar.orange { background: #f97316; }
        .bar span { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 0.75rem; font-weight: bold; color: #333; }

        /* Footer */
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; border-top: 1px solid #e2e8f0; display: flex; justify-content: center; gap: 15px; box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.1); z-index: 100; }
        .btn { padding: 12px 40px; border: none; border-radius: 8px; font-weight: 800; font-size: 1rem; cursor: pointer; transition: all 0.2s; }
        .btn-submit { background: var(--primary); color: white; }
        .btn-submit:hover { background: #1d4ed8; transform: translateY(-2px); }
        .btn-reset { background: #64748b; color: white; display: none; }
        .btn-save { background: #10b981; color: white; margin-top: 15px; width: 100%; padding: 10px; font-size: 0.9rem; }
        .btn-save:hover { background: #059669; }
        .btn-save:disabled { background: #9ca3af; cursor: not-allowed; }
        
        .score-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2); text-align: center; z-index: 1000; display: none; width: 90%; max-width: 400px; }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
        .score-circle { width: 120px; height: 120px; border-radius: 50%; border: 8px solid var(--primary); display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto 20px; }
        .score-val { font-size: 2.2rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .score-label { font-size: 0.9rem; color: #64748b; font-weight: 600; margin-top: 5px; }
        #saveStatus { margin-top: 10px; font-size: 0.9rem; }
        
        @media (max-width: 600px) {
            .header { flex-direction: column; text-align: center; }
            .mcq-grid { grid-template-columns: 1fr; }
            .bar-chart { gap: 10px; }
            .footer { padding: 10px; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <h1>TOÁN 6 - MÃ ĐỀ 05</h1>
            <p style="color: #64748b; margin-top: 5px;">Kiểm tra Cuối Kỳ 1 | Chân Trời Sáng Tạo | Thời gian: 90 phút</p>
        </div>
        <div class="timer" id="timer">90:00</div>
        
        <div class="student-info">
            <input type="text" id="studentName" class="name-input" placeholder="Nhập Họ và Tên của bạn để bắt đầu làm bài...">
        </div>
    </div>

    <form id="quizForm">
        
        <!-- SECTION 1: TRẮC NGHIỆM -->
        <div class="section-header">
            <h2>PHẦN I: TRẮC NGHIỆM (3.0 Điểm)</h2>
            <p class="section-desc">Chọn 01 phương án đúng nhất cho mỗi câu hỏi.</p>
        </div>

        <!-- Q1 -->
        <div class="question-card" id="q1">
            <span class="q-content"><span class="q-number">Câu 1:</span> Cho M = {a; 5; b; c}. Khẳng định nào sau đây là SAI?</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q1" value="A"> A. b ∈ M</label>
                <label class="mcq-option"><input type="radio" name="q1" value="B"> B. c ∉ M</label>
                <label class="mcq-option"><input type="radio" name="q1" value="C"> C. a ∈ M</label>
                <label class="mcq-option"><input type="radio" name="q1" value="D"> D. d ∉ M</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q2 -->
        <div class="question-card" id="q2">
            <span class="q-content"><span class="q-number">Câu 2:</span> Số tự nhiên x thỏa mãn x - 5 = 0 là?</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q2" value="A"> A. 1</label>
                <label class="mcq-option"><input type="radio" name="q2" value="B"> B. 0</label>
                <label class="mcq-option"><input type="radio" name="q2" value="C"> C. 5</label>
                <label class="mcq-option"><input type="radio" name="q2" value="D"> D. 10</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q3 -->
        <div class="question-card" id="q3">
            <span class="q-content"><span class="q-number">Câu 3:</span> Tính chu vi hình chữ nhật có chiều rộng 48cm và chiều dài 79cm.</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q3" value="A"> A. 381cm</label>
                <label class="mcq-option"><input type="radio" name="q3" value="B"> B. 127cm</label>
                <label class="mcq-option"><input type="radio" name="q3" value="C"> C. 254cm</label>
                <label class="mcq-option"><input type="radio" name="q3" value="D"> D. 128cm</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q4 -->
        <div class="question-card" id="q4">
            <span class="q-content"><span class="q-number">Câu 4:</span> Nếu giảm chiều dài đi 4cm, tăng chiều rộng 7cm của một HCN thì được hình vuông diện tích 64cm². Diện tích HCN ban đầu là:</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q4" value="A"> A. 14 cm²</label>
                <label class="mcq-option"><input type="radio" name="q4" value="B"> B. 9 cm²</label>
                <label class="mcq-option"><input type="radio" name="q4" value="C"> C. 10 cm²</label>
                <label class="mcq-option"><input type="radio" name="q4" value="D"> D. 12 cm²</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q5 -->
        <div class="question-card" id="q5">
            <span class="q-content"><span class="q-number">Câu 5:</span> Dựa vào biểu đồ cột kép dưới đây, số cá của Tổ 3 và Tổ 4 nuôi lần lượt là?</span>
            <div class="chart-visual">
                <div class="bar-col">
                    <div class="bar-pair">
                        <div class="bar" style="height: 60px;"><span>8</span></div>
                        <div class="bar orange" style="height: 40px;"><span>4</span></div>
                    </div>
                    <small>Chó</small>
                </div>
                <div class="bar-col">
                    <div class="bar-pair">
                        <div class="bar" style="height: 50px;"><span>5</span></div>
                        <div class="bar orange" style="height: 50px;"><span>5</span></div>
                    </div>
                    <small>Mèo</small>
                </div>
                 <div class="bar-col">
                    <div class="bar-pair">
                        <div class="bar" style="height: 90px;"><span>10</span></div>
                        <div class="bar orange" style="height: 20px;"><span>2</span></div>
                    </div>
                    <small>Chim</small>
                </div>
                <div class="bar-col">
                    <div class="bar-pair">
                        <div class="bar" style="height: 110px;"><span>12</span></div>
                        <div class="bar orange" style="height: 130px;"><span>15</span></div>
                    </div>
                    <small style="font-weight:bold; color:var(--primary)">Cá</small>
                </div>
            </div>
            <div style="font-size: 0.8rem; margin-bottom: 10px; text-align: center;"><span style="color:var(--primary)">■ Tổ 3</span> &nbsp; <span style="color:#f97316">■ Tổ 4</span></div>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q5" value="A"> A. Tổ 3: 10, Tổ 4: 14</label>
                <label class="mcq-option"><input type="radio" name="q5" value="B"> B. Tổ 3: 12, Tổ 4: 16</label>
                <label class="mcq-option"><input type="radio" name="q5" value="C"> C. Tổ 3: 12, Tổ 4: 15</label>
                <label class="mcq-option"><input type="radio" name="q5" value="D"> D. Tổ 3: 15, Tổ 4: 12</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q6 -->
        <div class="question-card" id="q6">
            <span class="q-content"><span class="q-number">Câu 6:</span> Bảng thống kê hạnh kiểm: Tốt (25), Khá (3), TB (2). Số học sinh có hạnh kiểm từ Khá trở lên là?</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q6" value="A"> A. 5</label>
                <label class="mcq-option"><input type="radio" name="q6" value="B"> B. 28</label>
                <label class="mcq-option"><input type="radio" name="q6" value="C"> C. 27</label>
                <label class="mcq-option"><input type="radio" name="q6" value="D"> D. 30</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q7 -->
        <div class="question-card" id="q7">
            <span class="q-content"><span class="q-number">Câu 7:</span> Tất cả các ước của 15 là:</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q7" value="A"> A. {1; 3; 5; 15}</label>
                <label class="mcq-option"><input type="radio" name="q7" value="B"> B. {0; 15; 30; ...}</label>
                <label class="mcq-option"><input type="radio" name="q7" value="C"> C. {0; 1; 15}</label>
                <label class="mcq-option"><input type="radio" name="q7" value="D"> D. {3; 5}</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q8 -->
        <div class="question-card" id="q8">
            <span class="q-content"><span class="q-number">Câu 8:</span> Có 10 quả cam chia cho 5 người. Mỗi người được mấy quả?</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q8" value="A"> A. 2</label>
                <label class="mcq-option"><input type="radio" name="q8" value="B"> B. 5</label>
                <label class="mcq-option"><input type="radio" name="q8" value="C"> C. 4</label>
                <label class="mcq-option"><input type="radio" name="q8" value="D"> D. 3</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q9 -->
        <div class="question-card" id="q9">
            <span class="q-content"><span class="q-number">Câu 9:</span> Giá trị của biểu thức a.b³ với a = -3, b = -2 là:</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q9" value="A"> A. 18</label>
                <label class="mcq-option"><input type="radio" name="q9" value="B"> B. -18</label>
                <label class="mcq-option"><input type="radio" name="q9" value="C"> C. 24</label>
                <label class="mcq-option"><input type="radio" name="q9" value="D"> D. -24</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q10 -->
        <div class="question-card" id="q10">
            <span class="q-content"><span class="q-number">Câu 10:</span> Tập hợp các ước nguyên của -12 là:</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q10" value="A"> A. {1;2;3;4;6;12}</label>
                <label class="mcq-option"><input type="radio" name="q10" value="B"> B. {±2;±3;±4;±6;±12}</label>
                <label class="mcq-option"><input type="radio" name="q10" value="C"> C. {±1;±3;±4;±6;±12}</label>
                <label class="mcq-option"><input type="radio" name="q10" value="D"> D. {±1;±2;±3;±4;±6;±12}</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q11 -->
        <div class="question-card" id="q11">
            <span class="q-content"><span class="q-number">Câu 11:</span> Có bao nhiêu số tự nhiên x thỏa mãn 3105 ≤ x ≤ 3111?</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q11" value="A"> A. 7</label>
                <label class="mcq-option"><input type="radio" name="q11" value="B"> B. 5</label>
                <label class="mcq-option"><input type="radio" name="q11" value="C"> C. 6</label>
                <label class="mcq-option"><input type="radio" name="q11" value="D"> D. 8</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- Q12 -->
        <div class="question-card" id="q12">
            <span class="q-content"><span class="q-number">Câu 12:</span> Lớp 6A (45hs), 6B (42hs), 6C (48hs) xếp hàng dọc sao cho số hàng bằng nhau. Số hàng dọc nhiều nhất là?</span>
            <div class="mcq-grid">
                <label class="mcq-option"><input type="radio" name="q12" value="A"> A. 3</label>
                <label class="mcq-option"><input type="radio" name="q12" value="B"> B. 4</label>
                <label class="mcq-option"><input type="radio" name="q12" value="C"> C. 2</label>
                <label class="mcq-option"><input type="radio" name="q12" value="D"> D. 1</label>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- SECTION 2: ĐÚNG SAI -->
        <div class="section-header">
            <h2>PHẦN II: ĐÚNG / SAI (1.0 Điểm)</h2>
            <p class="section-desc">Chọn Đúng hoặc Sai cho mỗi phát biểu.</p>
        </div>

        <!-- TF1 -->
        <div class="question-card" id="tf1">
            <span class="q-content"><span class="q-number">Câu 1:</span> Hình chữ nhật dài 8cm, rộng 5cm.</span>
            <table class="tf-table">
                <tr><td>a) Chu vi tính bằng P = (d + r) × 2</td>
                    <td width="120"><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>b) Diện tích bằng d × r</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>c) Chu vi là 13cm</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>d) Nếu tăng dài 2cm thì diện tích mới là 50cm²</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
            </table>
            <div class="result-feedback"></div>
        </div>

        <!-- TF2 -->
        <div class="question-card" id="tf2">
            <span class="q-content"><span class="q-number">Câu 2:</span> Mua 2 bó rau (10k/bó), 1kg cá (60k), 4 quả trứng (2.8k/quả). Mẹ đưa 200k.</span>
            <table class="tf-table">
                <tr><td>a) Tiền mua rau là 20.000đ</td>
                    <td width="120"><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>b) Tiền cá là 60.000đ</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>c) Tiền trứng là 8.000đ</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>d) Tiền thừa là 108.800đ</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
            </table>
            <div class="result-feedback"></div>
        </div>

        <!-- TF3 -->
        <div class="question-card" id="tf3">
            <span class="q-content"><span class="q-number">Câu 3:</span> Về Hình tam giác đều ABC cạnh 6cm.</span>
            <table class="tf-table">
                <tr><td>a) Ba cạnh bằng nhau</td>
                    <td width="120"><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>b) Ba góc bằng nhau và bằng 60 độ</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>c) Chu vi là 12cm</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>d) Có 3 trục đối xứng</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
            </table>
            <div class="result-feedback"></div>
        </div>

         <!-- TF4 -->
        <div class="question-card" id="tf4">
            <span class="q-content"><span class="q-number">Câu 4:</span> Về Bội Chung Nhỏ Nhất (BCNN) của a và b là 84.</span>
            <table class="tf-table">
                <tr><td>a) a và b đều chia hết cho 84</td>
                    <td width="120"><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>b) 84 chia hết cho cả a và b</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>c) Nếu a = 1 thì b = 84</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
                <tr><td>d) Mọi bội chung của a, b đều là bội của 84</td>
                    <td><div class="tf-btn-group"><button type="button" class="tf-btn" data-val="T">ĐÚNG</button><button type="button" class="tf-btn" data-val="F">SAI</button></div></td></tr>
            </table>
            <div class="result-feedback"></div>
        </div>


        <!-- SECTION 3: ĐIỀN KHUYẾT (KÉO THẢ) -->
        <div class="section-header">
            <h2>PHẦN III: ĐIỀN KHUYẾT (2.0 Điểm)</h2>
            <p class="section-desc">Bấm vào ô trống rồi chọn từ thích hợp để điền vào.</p>
        </div>

        <div class="question-card" id="dd1">
            <span class="q-content"><span class="q-number">Câu 1:</span> Khái niệm hình học</span>
            <div class="dd-area">
                <div class="dd-sentence">Hình thoi là tứ giác có bốn cạnh bằng nhau và hai đường chéo <span class="dd-slot" data-key="vuonggoc"></span> với nhau.</div>
                <div class="dd-options">
                    <span class="dd-chip" data-val="songsong">song song</span>
                    <span class="dd-chip" data-val="vuonggoc">vuông góc</span>
                    <span class="dd-chip" data-val="bangnhau">bằng nhau</span>
                </div>
            </div>
            <div class="result-feedback"></div>
        </div>

        <div class="question-card" id="dd2">
            <span class="q-content"><span class="q-number">Câu 2:</span> Số học</span>
            <div class="dd-area">
                <div class="dd-sentence">Số nguyên tố là số tự nhiên lớn hơn 1, chỉ có <span class="dd-slot" data-key="hai"></span> ước là 1 và chính nó.</div>
                <div class="dd-options">
                    <span class="dd-chip" data-val="mot">một</span>
                    <span class="dd-chip" data-val="hai">hai</span>
                    <span class="dd-chip" data-val="ba">ba</span>
                </div>
            </div>
            <div class="result-feedback"></div>
        </div>

        <div class="question-card" id="dd3">
            <span class="q-content"><span class="q-number">Câu 3:</span> Phép tính số nguyên</span>
            <div class="dd-area">
                <div class="dd-sentence">Muốn nhân hai số nguyên khác dấu, ta nhân hai giá trị tuyệt đối của chúng rồi đặt dấu <span class="dd-slot" data-key="tru"></span> trước kết quả nhận được.</div>
                <div class="dd-options">
                    <span class="dd-chip" data-val="cong">cộng (+)</span>
                    <span class="dd-chip" data-val="tru">trừ (-)</span>
                    <span class="dd-chip" data-val="nhan">nhân (x)</span>
                </div>
            </div>
            <div class="result-feedback"></div>
        </div>

        <div class="question-card" id="dd4">
            <span class="q-content"><span class="q-number">Câu 4:</span> Hình lục giác đều</span>
            <div class="dd-area">
                <div class="dd-sentence">Hình lục giác đều có 6 cạnh bằng nhau và 6 góc <span class="dd-slot" data-key="bangnhau"></span>.</div>
                <div class="dd-options">
                    <span class="dd-chip" data-val="khacnhau">khác nhau</span>
                    <span class="dd-chip" data-val="bangnhau">bằng nhau</span>
                    <span class="dd-chip" data-val="vuong">vuông</span>
                </div>
            </div>
            <div class="result-feedback"></div>
        </div>

        <div class="question-card" id="dd5">
            <span class="q-content"><span class="q-number">Câu 5:</span> Ước chung</span>
            <div class="dd-area">
                <div class="dd-sentence">Ước chung lớn nhất của hai hay nhiều số là số lớn nhất trong tập hợp các <span class="dd-slot" data-key="uocchung"></span> của các số đó.</div>
                <div class="dd-options">
                    <span class="dd-chip" data-val="boichung">bội chung</span>
                    <span class="dd-chip" data-val="uocchung">ước chung</span>
                    <span class="dd-chip" data-val="uocrieng">ước riêng</span>
                </div>
            </div>
            <div class="result-feedback"></div>
        </div>

        <!-- SECTION 4: TRẢ LỜI NGẮN -->
        <div class="section-header">
            <h2>PHẦN IV: TRẢ LỜI NGẮN (4.0 Điểm)</h2>
            <p class="section-desc">Nhập kết quả cuối cùng (chỉ nhập số).</p>
        </div>

        <div class="question-card" id="sa1">
            <span class="q-content"><span class="q-number">Câu 1:</span> Hình bình hành ABCD tâm O có OA=5cm, OD=7cm. Tính tổng độ dài AC + BD (cm)?</span>
            <input type="number" class="sa-input" id="inp_sa1" placeholder="Nhập đáp án...">
            <div class="result-feedback"></div>
        </div>

        <div class="question-card" id="sa2">
            <span class="q-content"><span class="q-number">Câu 2:</span> Chó đuổi thỏ cách 150dm. Bước chó 9dm, bước thỏ 7dm. Hỏi chó cần bao nhiêu bước để đuổi kịp?</span>
            <input type="number" class="sa-input" id="inp_sa2" placeholder="Nhập đáp án...">
            <div class="result-feedback"></div>
        </div>

        <div class="question-card" id="sa3">
            <span class="q-content"><span class="q-number">Câu 3:</span> Có 4 cửa hàng bán nước ngọt. Cửa hàng A có 2 biểu tượng, B có 3, C có 1, D có 4. Mỗi biểu tượng ứng với 12 lon. Cửa hàng A cần bán thêm bao nhiêu lon để bằng cửa hàng D?</span>
            <input type="number" class="sa-input" id="inp_sa3" placeholder="Nhập đáp án...">
            <div class="result-feedback"></div>
        </div>

        <div class="question-card" id="sa4">
            <span class="q-content"><span class="q-number">Câu 4:</span> Dùng ba chữ số 4, 5, 9 ghép thành số có ba chữ số nhỏ nhất và chia hết cho 2. Số đó là?</span>
            <input type="number" class="sa-input" id="inp_sa4" placeholder="Nhập đáp án...">
            <div class="result-feedback"></div>
        </div>
        
        <div class="question-card" id="sa5">
            <span class="q-content"><span class="q-number">Câu 5:</span> Tính tổng B = 1 - 3 + 5 - 7 + ... + 25 - 26. Kết quả là bao nhiêu?</span>
            <input type="number" class="sa-input" id="inp_sa5" placeholder="Nhập đáp án...">
            <div class="result-feedback"></div>
        </div>

        <div style="height: 60px;"></div>
    </form>

    <div class="footer">
        <button class="btn btn-submit" onclick="submitExam()">NỘP BÀI</button>
        <button class="btn btn-reset" onclick="location.reload()">LÀM LẠI</button>
    </div>
</div>

<div class="overlay" id="overlay"></div>
<div class="score-modal" id="scoreModal">
    <div class="score-circle" id="finalScore">
        <span class="score-val" id="scorePercent">0%</span>
        <span class="score-label" id="scoreRaw">0/10</span>
    </div>
    <h2>Hoàn thành bài thi!</h2>
    <p>Bạn đã hoàn thành bài kiểm tra Toán 6.</p>
    <button class="btn btn-save" onclick="sendToGoogleSheet()" id="btnSave" disabled>Gửi kết quả</button>
    <div id="saveStatus"></div>
    <button class="btn btn-submit" style="width:100%; margin-top:20px; background:#64748b" onclick="closeModal()">Xem chi tiết</button>
</div>

<script>
    // --- APP SCRIPT CONFIG ---
    // Thay đổi URL này bằng URL Web App của bạn
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxHSHaZOuPCnKDJkDzBv1UrwVb_9LDOYh9VfUe0WirXpSdUAuvvbDCJlPip0as8mET56A/exec';

    // --- DATA & LOGIC ---
    const ANSWERS = {
        mcq: { q1:'B', q2:'C', q3:'C', q4:'D', q5:'C', q6:'B', q7:'A', q8:'A', q9:'C', q10:'D', q11:'A', q12:'A' },
        tf: { 
            tf1: ['T','T','F','T'], 
            tf2: ['T','T','F','T'],
            tf3: ['T','T','F','T'],
            tf4: ['F','T','T','T']
        },
        dd: { dd1:'vuonggoc', dd2:'hai', dd3:'tru', dd4:'bangnhau', dd5:'uocchung' },
        sa: { sa1:'24', sa2:'75', sa3:'24', sa4:'594', sa5:'-13' }
    };

    // --- INTERACTION: MCQ ---
    document.querySelectorAll('.mcq-option input').forEach(inp => {
        inp.addEventListener('change', (e) => {
            const parent = e.target.closest('.mcq-grid');
            parent.querySelectorAll('.mcq-option').forEach(opt => opt.classList.remove('selected'));
            e.target.closest('.mcq-option').classList.add('selected');
        });
    });

    // --- INTERACTION: TF ---
    document.querySelectorAll('.tf-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const grp = e.target.closest('.tf-btn-group');
            grp.querySelectorAll('.tf-btn').forEach(b => {
                b.classList.remove('active-true', 'active-false');
            });
            if(e.target.dataset.val === 'T') e.target.classList.add('active-true');
            else e.target.classList.add('active-false');
            grp.dataset.selected = e.target.dataset.val;
        });
    });

    // --- INTERACTION: DRAG DROP ---
    let activeSlot = null;
    document.querySelectorAll('.dd-slot').forEach(slot => {
        slot.addEventListener('click', (e) => {
            document.querySelectorAll('.dd-slot').forEach(s => s.style.borderBottomColor = 'var(--primary)');
            activeSlot = e.target;
            e.target.style.borderBottomColor = '#f59e0b';
        });
    });
    document.querySelectorAll('.dd-chip').forEach(chip => {
        chip.addEventListener('click', (e) => {
            if(!activeSlot) return;
            activeSlot.textContent = e.target.textContent;
            activeSlot.dataset.currentVal = e.target.dataset.val;
            activeSlot.classList.add('filled');
            const parent = e.target.closest('.dd-options');
            parent.querySelectorAll('.dd-chip').forEach(c => c.classList.remove('selected'));
            activeSlot = null;
        });
    });

    // --- TIMER ---
    let time = 90 * 60;
    const timerEl = document.getElementById('timer');
    const timerInt = setInterval(() => {
        const m = Math.floor(time / 60);
        const s = time % 60;
        timerEl.textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
        if(time > 0) time--;
    }, 1000);

    // --- SUBMIT ---
    let finalScorePercent = "";
    
    function submitExam() {
        // Validate name
        const nameInp = document.getElementById('studentName');
        if (!nameInp.value.trim()) {
            alert("Vui lòng nhập Họ và Tên trước khi nộp bài!");
            nameInp.focus();
            return;
        }

        clearInterval(timerInt);
        let score = 0;
        let maxScore = 10; // Tổng điểm chuẩn là 10

        // 1. Grade MCQ (12 câu -> 3.0 điểm -> 0.25đ/câu)
        for(let i=1; i<=12; i++) {
            const qID = `q${i}`;
            const sel = document.querySelector(`input[name="${qID}"]:checked`);
            const fb = document.querySelector(`#${qID} .result-feedback`);
            fb.style.display = 'block';
            if(sel && sel.value === ANSWERS.mcq[qID]) {
                score += 0.25;
                fb.className = 'result-feedback correct';
                fb.innerHTML = '✅ Chính xác!';
            } else {
                fb.className = 'result-feedback wrong';
                fb.innerHTML = `❌ Sai. Đáp án đúng: ${ANSWERS.mcq[qID]}`;
            }
        }

        // 2. Grade TF (4 câu -> 1.0 điểm -> 0.25đ/câu)
        for(let i=1; i<=4; i++) {
            const qID = `tf${i}`;
            const rows = document.querySelectorAll(`#${qID} .tf-table tr`);
            let correctCount = 0;
            rows.forEach((row, idx) => {
                const btnGrp = row.querySelector('.tf-btn-group');
                const userVal = btnGrp ? btnGrp.dataset.selected : null;
                const correctVal = ANSWERS.tf[qID][idx];
                if(userVal === correctVal) {
                    correctCount++;
                    if(btnGrp) btnGrp.style.border = '2px solid #22c55e';
                } else {
                    if(btnGrp) btnGrp.style.border = '2px solid #ef4444';
                }
            });
            // Mỗi câu lớn 0.25đ, chia đều cho 4 ý nhỏ -> 0.0625đ/ý
            score += correctCount * 0.0625;
            
            const fb = document.querySelector(`#${qID} .result-feedback`);
            fb.style.display = 'block';
            fb.className = 'result-feedback ' + (correctCount==4 ? 'correct':'wrong');
            fb.innerHTML = `Bạn đúng ${correctCount}/4 ý.`;
        }

        // 3. Grade DD (5 câu -> 2.0 điểm -> 0.4đ/câu)
        // Lưu ý: Đã điều chỉnh thang điểm lên 2.0 cho phần này để tổng là 10
        for(let i=1; i<=5; i++) {
            const qID = `dd${i}`;
            const slot = document.querySelector(`#${qID} .dd-slot`);
            const userVal = slot.dataset.currentVal;
            const correctVal = ANSWERS.dd[qID];
            const fb = document.querySelector(`#${qID} .result-feedback`);
            fb.style.display = 'block';
            if(userVal === correctVal) {
                score += 0.4;
                fb.className = 'result-feedback correct';
                fb.innerHTML = '✅ Chính xác!';
            } else {
                fb.className = 'result-feedback wrong';
                fb.innerHTML = '❌ Sai rồi.';
            }
        }

        // 4. Grade SA (5 câu -> 4.0 điểm -> 0.8đ/câu)
        // Lưu ý: Đã điều chỉnh thang điểm lên 4.0 cho phần này để tổng là 10
        for(let i=1; i<=5; i++) {
            const qID = `sa${i}`;
            const inp = document.getElementById(`inp_${qID}`);
            const fb = document.querySelector(`#${qID} .result-feedback`);
            fb.style.display = 'block';
            if(inp.value.trim() == ANSWERS.sa[qID]) {
                score += 0.8;
                fb.className = 'result-feedback correct';
                fb.innerHTML = '✅ Chính xác!';
            } else {
                fb.className = 'result-feedback wrong';
                fb.innerHTML = `❌ Đáp án đúng: ${ANSWERS.sa[qID]}`;
            }
        }

        // Calculate Percentage
        let percent = (score / maxScore) * 100;
        finalScorePercent = Math.round(percent) + "%";
        
        // Update Modal
        document.getElementById('scorePercent').textContent = finalScorePercent;
        document.getElementById('scoreRaw').textContent = `Điểm số: ${score.toFixed(2)}/10`;
        
        document.getElementById('scoreModal').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
        document.querySelector('.btn-submit').style.display = 'none';
        document.querySelector('.btn-reset').style.display = 'inline-block';
        
        // Enable save button
        document.getElementById('btnSave').disabled = false;
    }

    // --- SEND TO GOOGLE SHEET ---
    function sendToGoogleSheet() {
        const name = document.getElementById('studentName').value;
        const btn = document.getElementById('btnSave');
        const status = document.getElementById('saveStatus');

        if (!name) {
            status.textContent = "⚠ Lỗi: Chưa nhập tên học sinh!";
            status.style.color = "red";
            return;
        }

        if (SCRIPT_URL.includes("YOUR_GOOGLE_SCRIPT")) {
             status.textContent = "⚠ Lỗi: Chưa cấu hình URL Script!";
             status.style.color = "red";
             return;
        }

        btn.disabled = true;
        btn.textContent = "Đang gửi...";
        status.textContent = "";

        const data = {
            timestamp: new Date().toLocaleString('vi-VN'),
            name: name,
            score: finalScorePercent // Gửi phần trăm về Sheet
        };

        // Sử dụng mode 'no-cors' để tránh lỗi CORS khi gọi từ local/file
        fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors", 
            headers: {
                "Content-Type": "text/plain" // Changed from application/json to text/plain
            },
            body: JSON.stringify(data)
        })
        .then(() => {
            // Vì no-cors không trả về response, ta giả định thành công nếu không có lỗi mạng
            status.textContent = "✅ Đã gửi kết quả thành công!";
            status.style.color = "green";
            btn.textContent = "Đã gửi";
        })
        .catch(error => {
            console.error('Error:', error);
            status.textContent = "❌ Có lỗi xảy ra. Vui lòng thử lại.";
            status.style.color = "red";
            btn.disabled = false;
            btn.textContent = "Gửi kết quả";
        });
    }

    function closeModal() {
        document.getElementById('scoreModal').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
        window.scrollTo(0, 0);
    }
</script>

</body>
</html>
